(function(e,t){typeof define=="function"&&define.amd?define(["d3","../common/SVGWidget","./IWordCloud","d3-cloud","css!./WordCloud"],t):e.other_WordCloud=t(e.d3,e.common_SVGWidget,e.other_IWordCloud,e.d3.layout.cloud)})(this,function(e,t,n,r){function i(){t.call(this),n.call(this)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._class+=" other_WordCloud",i.prototype.implements(n.prototype),i.prototype.publish("padding",1,"number","Padding",null,{tags:["Intermediate"]}),i.prototype.publish("fontFamily","Verdana","string","Font Name",null,{tags:["Basic"]}),i.prototype.publish("fontSizeFrom",6,"number","Font Size From",null,{tags:["Basic"]}),i.prototype.publish("fontSizeTo",24,"number","Font Size To",null,{tags:["Basic"]}),i.prototype.publish("angleFrom",-60,"number","Angle From",null,{tags:["Basic"]}),i.prototype.publish("angleTo",60,"number","Angle To",null,{tags:["Basic"]}),i.prototype.publish("angleCount",5,"number","Angle Count",null,{tags:["Basic"]}),i.prototype.data=function(e){var n=t.prototype.data.apply(this,arguments);return arguments.length&&(this._vizData=e.map(function(e){var t={};for(var n in e)t["__viz_"+n]=e[n];return t})),n},i.prototype.enter=function(t,n){this.cloud=(new r).font(this.fontFamily()).padding(this.padding()),this.zoomListener=e.behavior.zoom().scaleExtent([1,10]).on("zoom",function(){n.attr("transform","translate("+e.event.translate[0]+","+e.event.translate[1]+")"+"scale("+e.event.scale+")")}),this._parentElement.call(this.zoomListener)},i.prototype.update=function(t,n){function u(t,i){var o=e.scale.category20(),u=n.selectAll("text").data(t,function(e){return e.__viz_0?e.__viz_0.toLowerCase():""});u.transition().duration(1e3).attr("transform",function(e){return"translate("+[e.x,e.y]+")rotate("+e.rotate+")"}).style("font-size",function(e){return s(e.__viz_1)+"px"}).style("opacity",1),u.enter().append("text").attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+")rotate("+e.rotate+")"}).style("font-size",function(e){return s(e.__viz_1)+"px"}).style("font-family",function(e){return e.fontFamily}).style("fill",function(e){return o(e.__viz_0?e.__viz_0.toLowerCase():"")}).text(function(e){return e.__viz_0}).on("click",function(e){r.click({label:e.__viz_0,weight:e.__viz_1})}).style("opacity",1e-6).transition().duration(1e3).style("opacity",1),u.exit().transition().duration(1e3).style("opacity",1e-4).remove();if(i){var a=r.width(),f=r.height(),l=i[1].x-i[0].x,c=i[1].y-i[0].y,h=.9/Math.max(l/a,c/f);n.transition().delay(1e3).duration(750).attr("transform","translate("+r._pos.x+","+r._pos.y+")scale("+h+")"),r.zoomListener.scale(h).translate([r._pos.x,r._pos.y])}}var r=this,i=e.extent(this._vizData,function(e){return e.__viz_1}),s=e.scale.log().domain(i).range([this.fontSizeFrom(),this.fontSizeTo()]),o=e.scale.linear().domain([0,r.angleCount()-1]).range([r.angleFrom(),r.angleTo()]);this.cloud.size([this.width(),this.height()]).words(this._vizData).rotate(function(){return o(~~(Math.random()*r.angleCount()))}).fontSize(function(e){return s(e.__viz_1)}).on("end",u).start()},i});